version: v1alpha1
debug: false
persist: true
machine:
    type: controlplane
    token: ENC[AES256_GCM,data:pGJcc6Zgs9FkN4zoXtGlySNh22yZuUk=,iv:CRLAw9xUxjIJQE2RM+AN2AD67L/m7UEHdAd85TNXgF4=,tag:9dRIdNsG2KR51btHkASs7Q==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:h3Ax3KPdGJOCVcxpUjxn4w5978mj1hykqtaLXOgB6jZHPZ8ZubwbcNbk2sAPhrV0jZ79n8QY+YEHjRxpLLmILI6NoJybwIijeNHemPMI27KXDs1rgT3E2fZM8+sG7y2+YXsaG0+fhBGP52l8Ci7GDWfut+dFGjSo0/nEs0I7nGz3W+oPWuFel2JYTxIXu469s/nayiwC3hNVVd6RS5V6Lt8fviHfWQh/jeTIVQ4AYc/8GNDfisytOFcQI1W9DvszPdqq075ovXS/+bIqMDbLCL8iUDRpKOyCFZT8XTCyhudXVN5UXkbOBXaIuvol0g4wp48KoLn7WVrBiiR2KSnTMX/vPiT/LSM6aCDvza55DoLa01UGci9brEk8cta0EODJA3JJ7VhCBeBa3Ze92dSHSd5GegRDGpiWASHCLMeqTognoyqJu37rk1qFLs9EiwD+zGYQm2Rdn38+GJ2agXMGHQP32YwrvxqIY1iu/QmB+y63zyBlbEKKDEIDqOToYC4eiKBUBEPmzWRS9LepmZyPa/nmoFi3/tSC/DsKecYdUp6Mq+nhJe5ZK6DakZYCTfGkNtvvnwwaJv7o8ZjkWAtFvTK5gUAfGPvqd4wD2mmH/5+ikc36bUdeNzqKQ4ShFlSjbrIsTL6LO7zmkdo2PBzVruKUZf3OY4kLiIR0zGgJUVYUSfkDeWLPYBjDKMblDOxlPo+SgFGO8LmwJmi0rCkzC8Gep9SJZK0mC/UEi2M7hTxpUSPVC54qvlasK3p5fJFTNOybeSdaWsth+wrIuM0QLROUlFrGdmMHdcMWf8oaHnfJ47OfUNmBl5gDLuO7xnKoIK3DgdCF1qdkvkTcW60nvSw5p/pkwm8ca2Qh+84GVCN4vLTT,iv:RFE8vb3zCABky4mhIsZBa0Ts1sbCnzH2SFbxweEn8iA=,tag:azmYU3qtjeokUw1YDIp/SA==,type:str]
        key: ENC[AES256_GCM,data:l96pr6qTc6d0O4IXmDbjvHnhJUXULUiAB61a6f7kr9nuhESipG5LvNFISdJAn97BrrOC3e1pvzbNNFXn+JaIvstWoKYDd5Dl5UaH2B5CuomRg/cDnlvQ8ceNhY6rlDScoIxXHt5kSVH+xLgqZbzb/Ywb+qR9yT7fRFJ+QLnbjPQVGAd3xzKo/3s9rCGfEYUPWayLfRrIK4q9xMyc85GnntrSdCu88Ez4crfTOPq2wza20psC,iv:8citMFj1yy0efYe6QLeRHl4KYz12KzVNawCg3PCRnCk=,tag:84f5EGoZyiSWVietazrL5Q==,type:str]
    certSANs:
        - 127.0.0.1
        - 192.168.15.254
    kubelet:
        image: ghcr.io/siderolabs/kubelet:${KUBERNETES_VERSION}
        extraArgs:
            image-gc-high-threshold: "55"
            image-gc-low-threshold: "50"
            rotate-server-certificates: "true"
        extraMounts:
            - destination: /var/openebs/local
              type: bind
              source: /var/openebs/local
              options:
                - bind
                - rshared
                - rw
        defaultRuntimeSeccompProfileEnabled: true
        nodeIP:
            validSubnets:
                - 192.168.15.0/24
        disableManifestsDirectory: true
    network:
        interfaces:
            - deviceSelector:
                hardwareAddr: bc:24:11*
                # driver: virtio
              mtu: 1500
              dhcp: true
              vip:
                ip: 192.168.15.254
        nameservers:
            - 192.168.15.1
    install:
        disk: /dev/sda
        # diskSelector:
        #     model: Samsung SSD 870
        extraKernelArgs:
            - mitigations=off
            # - net.ifnames=0
            # - module_blacklist=e1000e
        image: factory.talos.dev/installer/${TALOS_SCHEMATIC_ID}:${TALOS_VERSION}
        wipe: false
    files:
        - content: |-
            [plugins."io.containerd.grpc.v1.cri"]
              enable_unprivileged_ports = true
              enable_unprivileged_icmp = true
            [plugins."io.containerd.grpc.v1.cri".containerd]
              discard_unpacked_layers = false
            [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
              discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    time:
        disabled: false
        servers:
            - 192.168.15.1
    sysctls:
        fs.inotify.max_queued_events: "65536"
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "524288"
        net.core.rmem_max: "2500000"
        net.core.wmem_max: "2500000"
    features:
        rbac: true
        stableHostname: true
        kubernetesTalosAPIAccess:
            enabled: true
            allowedRoles:
                - os:admin
            allowedKubernetesNamespaces:
                - system-upgrade
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
    udev:
        rules:
            - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
            - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
    nodeLabels:
        topology.kubernetes.io/region: main
        topology.kubernetes.io/zone: m
cluster:
    id: ENC[AES256_GCM,data:poDqpvQJvhSNlqncBNe1QCQkG1VlbDCf74xwIeGYEjsLdEO26EUnEfFnPK0=,iv:NTDqvHJe2Cf0kxOGrv0Ixx6682Lel26nM7ylpfftF7Y=,tag:67wCfIT+7qpYIaT6SucXqw==,type:str]
    secret: ENC[AES256_GCM,data:WR6qcHu5Od1q+4VFdZUH6NQGtAKeWSQW6eX5qKDhPcY0WYhIZkfxIzRdy1U=,iv:r+5C/ZM9/zs1VQXEG/2jlicuuG4+Lk6TwlDfixKqwFk=,tag:Gaz1MIjbkOjhGA3GaRp6/g==,type:str]
    controlPlane:
        endpoint: https://192.168.15.254:6443
    clusterName: main
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    coreDNS:
        disabled: true
    token: ENC[AES256_GCM,data:2D/Rg/VeC9lhYy2kXSmlPgCIF+lLurc=,iv:AoyiJrUuV4dbBUdW+AJddCk5LV5/2f2Tm+3LWQeNwtI=,tag:7/SaNyIIPEQynDbIatehyQ==,type:str]
    secretboxEncryptionSecret: ENC[AES256_GCM,data:l9bLSU7RjmBYrqG6JlEtz7O6vv1SbJsl6Q5F/9UflbWi8HCYSuuzSm536mk=,iv:QvoYtjhoda7e2RLeUpnXjxjFJh0YcwoZEAPuWAlsLDI=,tag:1q8Tps+dQCDJkk9FQKKXKQ==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:x3tk6aPqUIP7knIOap5v+INWswvIXzcjAdu9+8a16aBav7ZNg8V7/TzTmYy5ykwa7OvfP2CnljdAgPO1+MxZB9RLni+GUwfMU6/c0pTAoTAF4PVKXYJIFuHb9aknnxGkrBjxQhVmk9+Z/MP/fcbjV7ZvH/4pZBr4hWjZ4DZ1INs/UhzQ9jeAGDn36eZwS4W4jVuAadYcLmLEcWBcmee5YLZ0RB1kS9+uRRBF+hPqaKD+r2s1B5Bi3fhTgNUSnVaKf4G9wRNDHdP+A+xrskXmUPI6L4rBFc/nH4N17j9sOItGOAEq4Us0VJ2bKU/BsWPxeNwaSOh96jOp8EDRU/Egxfla8NdOa1ON/LmQyZB+zHGYGLx2bIBoQ4ebvt4Qe5wnWItYllh+Uz/Df+L8IxXejXjZuDUKsac/MhOAqivKE1NSlXSG5bMBVMmU8RZHRLKDtZacCTgOntmv1zg2Dq7cibw9lIGnwkN5HwMiquLpc0yQJt64KJUXY8ub+niFqBxPZhQTqWUDTAZZexirdD4nwn5+lHMo3ylSkIjs8+WMHpSZ8mWclNl/i84VT6l/zMKV2gxtbJhb6Db0vwoq/p8JKFGf2twgy7NBE7SHptkioJn8ixep6R5KjH/Jjs8FUDh+tUiotkgo1uzP14rke6aqA1NYfBbkv3ZYaqm2uylpq0cPRvJfk9skPme2iVP+PJWsNB/RsuLnTFlsE7UQsXMJIPc/8AAnmtm1NHJFG6xkbwicZnJfuhwK9GUvYavUp9EYm0ozKUlBfUTJURv/YhDbfDJIJ0ZDZjP1AMMMDTG9m5Ke1poGHnJABX+eJgqZLSLPPwsHTtNY4Fma5+/OBh9fpMEtGg2j5Ag8m8X9QNptEpZQsKiDmz4YzW9bhIF/Ano6qzadhoWQWhMHvsTmUZ0vylEXit7KaXTTdSEyHthbY4yGK/hvi6pQLTXrI/rsc65ugEl/O9/8YDH1BRXIOJjkK4dF0eYIMjoVfYQF2rK6BVb8jsnrkoXyWL5eI+G55v0pnls9CQSDqvklHrtb8Xg/gwnhMG50FZ1J++3TCw==,iv:aanednRvTCK0XdjIEyH4ulzjrdEggeQoStI7SmiVAVQ=,tag:SHuJ32Y53QegwM3RZsZnAg==,type:str]
        key: ENC[AES256_GCM,data:YTED8uIUE/YLK0wyc9DgNPdFGRdNWEYq6ufLcy/GSPRS6nGYCGaGnKb78v9/SwiLa/EWsQMifIqd+6NcXNgRsdSR75ZbJxkmUUj6Qw7EOQslqQP6yfX85d5EA1AsfW9Mbq7qqWC1g3ZlAXUspGfy5smfFpzkoAKj05dl4tAS6Y6P4iw1kCWZxJqZGy5jJEIMeSboGIMpgF5JjgLhrwZpWDEhTB7itqbpdR0nJIwlfYvsijRM1hV+JiyCXwk/MAzSl/S4PUPDN9TZ4CnehOUr8vwYEVB5sQbift86gF5BeGeW4oH3rMWpn584iaGZE2Etd7OQS2CT0g9AMOZE0cpSxbbs1PH8F7qll9vO2jYO/rf9RjyQEqmIfD99BXMjusaLQpVbkBP5klZL2UPKUFAVsg==,iv:8y+RAMVGeLg1+Drtpeb+HvOYO/kV439OJLbLDUU7Lks=,tag:5e9CkCHPpyvF1NHvicA6TA==,type:str]
    aggregatorCA:
        crt: ENC[AES256_GCM,data:sr2TLXVPM/X+7RIn0Z/h2DNESpcMLD+0s0ueBhr3/VqupSOSGhNtBcGx5VnQrkm6+LUL8Ud1I/JaNglfwh/ddwfWq73ZtSiUv/8DU4/h/ci6sgSsARNfkUo6jRQBRAvDdeawARGoLdCLCpFdC7vWnpYrh0RYKatpSTjq7ZCBZnKF77R2HvquF0U/jl+eHxVc5cvjSMsEO+b93DYDkZzU/nIFIslp5HN+z3Aa3sHw+q3gDuLa804xNxKlMHbpZG13AERtxamoaPH9Nbjbv/cba3kxaTD/MKBWT29o+TeSN8ijbJd3sZFKAU/kZEq5Ygj/kJFik+QMI+rF2++m/+e6Qw264tjxPRkJZMH0pFLaqqNuJZ1bJCzsKrc2ojFAdBAS2qXOiZa7dNvYyXeklEneRSRIDSyYO4VIQsgcla4bvltamVU+bV1t49bn7Fg29sEAMQ+gNZdJLUpRQuHrsYYFXgUVZZLkTXHA8xpFMr7G6G9cFNc7N854QhEVyt3DEQUqsYcR6TBXFK7NnUsSsRtRfj+RDmKloPlBAoaXhycJSPxZmdEB7wF5G093fsF8Psy/yARZ/m4an2osc6TTeQbZUtxnrjxGCsqA22sTxpBYjD59GWQdOQRZzuZD1YoRehg9+L3RdSG52EjHn/k9bX9Pgt9J40zs+vcmaKLZ1mSZDIIlaQYmb8M0/6CX+HzSaTQGDV7b3BCcgZGW75JqD0i9x+ERpooC6lp6MEb7/PAbXgHt929wr3qDwVKUbiD/GRFwNuw8jMJo+OrUAQFsBMTlj1dxR1uKuB1Oukf4owEW3EiePUbzSERryoO4t3UPaZ28lomJu5hJ+82tye+PL3wT1WuoEK4LYggK1zMVYPh/tWHLjLNh28Zr4xkZiVe5LVGNaJGgmac3we4mflnv1V9aikDRflpRphrv0VZmpr8UPYXlL1wkosQqmKlEk4CA3DL6,iv:ZqqmfMU2r5eeXCxA9KTUjehcqY7Cj5ipOE8lpH7fWyA=,tag:9NWOpiU1f2hdqNK/rAI5Lg==,type:str]
        key: ENC[AES256_GCM,data:ag7KkMGJatrFcfviGlstjc+p1qOA7QroOTfU1yiv8/Z9RbUUFZn+yO44CdlhP6nezL3gUvs5YhuoNpgqraExILRqDL2uBzVroB5xk/gjgzhHeoRoXw3x3juISV3vcQb0nBhE9lu4GZPOTf3Pwh8mMYYcysKJchPRbyRAUjDujAJJXHU1+sL0K3VEl3shHYacjdSVs2iDzj5B9yLowb4l4K9K3nLAB3bXL8MwopgnBVOiOKdceIf6KnOrtrIgaLp+p9SMhtfCtzo5VoM+fCmuLUTGFnykf60JC0IzVVzbjEJjVgfwbqNl/3oJh+1ZqHF3JW9Ng07NgrP6ST/jEtSvIDJgOaeHRw2PcA/L1WLWy39SGpbm4ES9rC6nviEDAyu5IguN+LyyZwuBJ5B+nK9rng==,iv:mrEmJQXTLszSLzrK7QmAV/m3/VPutz+LqzFCbJWppvU=,tag:43pE8nZZqsOpKmnP23Tkzw==,type:str]
    serviceAccount:
        key: ENC[AES256_GCM,data:g5ljuHpmKSuck249X6uYb3DjRqPgeDC/p31+tLzzxNheiuXGD1L1bh0iGT0UWc2YNqX83ZrisbRDf4dfYt9MOk3UrNZuo9FREW7fVqr/7fEHEeRW1L2o0MAdHejqm7M71Ot+qB0kOn5I7YkS1MphkgHbLId/v0DUCf0C07AmKmVuRnHbUnTyUuULGnRQCNZ3O2H4pF2o0b+Ylny5AIZxWl6mMbyotZxbv5a1E3qYuqKawRDSddEQi7uAhWwEO7ncJBwyRdPDn9zC0sGJahzX/zHXU/AifXPAf/jHlL6n/Bdm9v/cs6S6Qf5kaS5F0eeJBpkg7ochuM4joe7clgC8/11A0IdlHmzloIUrlShwNoTzFNWCpwbEnPbi3+KGeeAg0nH6alcDJk5qBSNwU5dotA==,iv:pAIfwp5LObWEpTDxK8LhDMwTab647KqcUBWyVztVnl0=,tag:F9IvcNsG1zfGkqR0zVI15g==,type:str]
    apiServer:
        image: registry.k8s.io/kube-apiserver:${KUBERNETES_VERSION}
        certSANs:
            - 127.0.0.1
            - 192.168.15.254
        disablePodSecurityPolicy: true
        auditPolicy:
            apiVersion: audit.k8s.io/v1
            kind: Policy
            rules:
                - level: Metadata
    controllerManager:
        image: registry.k8s.io/kube-controller-manager:${KUBERNETES_VERSION}
        extraArgs:
            bind-address: 0.0.0.0
    proxy:
        disabled: true
        image: registry.k8s.io/kube-proxy:${KUBERNETES_VERSION}
    scheduler:
        image: registry.k8s.io/kube-scheduler:${KUBERNETES_VERSION}
        extraArgs:
            bind-address: 0.0.0.0
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
    etcd:
        ca:
            crt: ENC[AES256_GCM,data:6AiDmGPA667t3CXuU7yfapen+3WFA+o2MRLG0tRb1JoWLO33WcwaD8e43pytswzX+swEUI6mdQKR6YSGRtJGASOBL0cdMcGj+XvrsO4Mph+lIcQg8xleoqHLiEILaCgJsFYs+lhPVAVkF2Vn3itVwUj/IV9mD+SOc4vU17zEapZn4xWc337wbNqCZdraRLANs4bKDgbJwrs4SfxHFADHQlRU7nyj2OKFWBngd2OQ/ssKwg7q3BEjiECbd8wYvkvd9cZa6jNywUbccKyJmvuq/fNg9lcJB3ZcdfxePn++LhNGKffPBCXwrogIRAnvaGU1S7JJbPSPagePWewRsZMBl8pVoYgOLzEFJv4gi1CAG3p5a0EMmYvJi5ofZWD36eruSU1TkpAtochl5Wypx0wPIqqmdNO3AUT66otHc6qv9l9A2Zp9RWm7qHVLSkjCs/UgSSchdiQTK9owyg9059BtgrwitwGV71Lo3IaKwuLq6/wvNlhx5DLxZfV4Gh5QU4dWQafJWnHXCEqM/XdxeviIGBB2FvOBNaC5LEHgHk+7a5AR0DpxVPsfvD8MG1NHv96gEn+SHGY/dZhuG86phsy7tbBZYyFLgCP0mPYc5Fo5UVDGXbJOn0gtPvj8zo0UQCMAoZ3/fsh1Q7DMjQAexr3K8eCdsYYl87X3TUyU7mv4vUSkEBR+x16XhfVd+2m96qHKau91EDa8BacuaaIqmvU+hnboAcO5g6HJO8DfLzt+OSstzgUwZsZsvfrD3UN5dNDN234ndIKA3UkIGMZprpKyx/VFqQiLU1rbSiqlkgsNqCHcj10Vk3+5cpdIMyprJ9pw+Xr96pD1RnyTXKftUo+FzUamZDy18TqdAuuRbHQyoK5bS/qPehRKIPSoE4dOhvyyZClbW77Iw1qeibBISj7Vz8w3KD+Gw3AvP2g1+S7j53o1vgZliAFCXtCUNmMSvRJTeMX3EYI11y7PtNPQIJRx/8/njj4qyYB0h3o+p6SkqZ41LGQRFNz9QYcivA18QQoWa4v4zg==,iv:kLIGoxpBdTP0NzggbogV+DF2MqxZOZMZI0XXHmDKI28=,tag:W1bpGrhq9fHVHAPLgkaPSw==,type:str]
            key: ENC[AES256_GCM,data:zc4L07ZeKLjb2mFkV4dV24+Rg9Z4GHsuxDRYzA8vH6g0S7dm1qeG0T8aDjgZvUyKNAHgVJdH10H8qHxHW2T5pFQeabNGjkOMVds0Ad94fMWu8aQ9JN18yFuDD03PP2j64pRdA0n3JkxNChrlAitHTHgmK8v0IYfkKtiUrifDOqjP+MiauZqnBS2G7iF1lIa71xFB+NAJrqrewZw6VoYMjGDKfjG8tp193da7epuDUBcjnTPqAv2WDrdOp9P1twwgJ9sWN3UEky4ja5P6fREMXJVoFkqbIgcm3EK8Y6J1F6vOrASzT/fgjyC7KcEAkBovd0d9ctGH7Jp+fG0FpvjHRebqWtzmoTTdkcIxwQQz3DEOJ6x/uHUeCw3i5U+bUkKpUBctF4aV0YsTM0y01YfNjA==,iv:5exZnTR/PirpNp2qG6edWZ4ffHnBEeXZRs9fJGH6YLQ=,tag:XjtqJOO8SQKaJH9uOjMcaA==,type:str]
        extraArgs:
            listen-metrics-urls: http://0.0.0.0:2381
        advertisedSubnets:
            - 192.168.15.0/24
    allowSchedulingOnMasters: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1qqz7ryljcrncf70a6n0yqptdq34nte99uj8j6ppucw94npccad0q304pkw
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBVY21pUTZOWkcvZytIYUM5
            aWRSemhMdmhZbEhEK0M5R0ZNZHBCdUttL0JrCi9DYUZJMkI2U0htaWF2TjZRWWxu
            bjU3TFVKQUZYT1BlcllxOVM3U2FVc0kKLS0tIGo3NG50UkRodmJxeFZXWjFCbnI1
            Z2VHTVV3V0dtOE5vZHVORUN5aDZ1YlUKrxkAsj1pWc2inl9SuK26pK7ryzUFZEQe
            7uQktXHJyQPJjzJT+dNBcaYzLCLdIV+EyWz19Sil5jzKZQHCfrCNzQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-04-11T09:46:20Z"
    mac: ENC[AES256_GCM,data:yojl6pTkBnkQVRuIVrhpywrTw3HwVRrz1F/AIohPAhS7TIxTRswyldAsFAGbG5l4/kEP83oa350ApGaicADYSIB4/2fmBF0MR8TuoKDG9DYgHApkjZp2uOFiGDHTNP1VSh2rTNB0kiBx1KTZ+aGXUQQgaa6CYRGgHuvrOwCSCc8=,iv:oQfJQQM6BcLtFymZ8a1xMXNRrzLUxXWYcWke2qANGZ8=,tag:G6CN2cAjjnWP6M8mEUHcHA==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
